<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bucles FOR - Aventuras Piratas</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- Estilos adicionales para el verificador -->
    <style>
        .execution-status {
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            transition: all 0.3s ease;
        }

        .execution-status.waiting {
            border-color: #ffc107;
            background: #fff3cd;
        }

        .execution-status.executed {
            border-color: #28a745;
            background: #d4edda;
            animation: pulse-success 1s ease-in-out;
        }

        .execution-status.error {
            border-color: #dc3545;
            background: #f8d7da;
        }

        @keyframes pulse-success {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .status-icon {
            font-size: 1.5rem;
            margin-right: 8px;
        }

        .verify-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }

        .verify-button:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .verify-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .mini-log {
            background: #1e1e1e;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 0.8rem;
            max-height: 100px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¥‚Äç‚ò†Ô∏è Aventuras Piratas üè¥‚Äç‚ò†Ô∏è</h1>
            <p>Aprende bucles FOR y WHILE con el Capit√°n CodeBeard</p>
            <div class="pirate-emoji">‚öîÔ∏èü¶úü™ô</div>
            <div class="contador-monedas-container">
                <div class="monedas-info">
                    <span class="monedas-label">ü™ô Monedas de Oro:</span>
                    <span id="contador-monedas" class="monedas-count">0</span>
                    <div class="monedas-objetivo">
                        Meta: 12 monedas para ser Maestro Pirata
                    </div>
                </div>
            </div>
        </div>

        <!-- Navegaci√≥n Principal -->
        <div class="lesson-section">
            <div class="navigation-tabs">
                <a href="index.html" class="nav-tab">üß≠ Introducci√≥n</a>
                <a href="bucles-for.html" class="nav-tab active">üó∫Ô∏è Bucles FOR</a>
                <a href="bucles-while.html" class="nav-tab">‚öîÔ∏è Bucles WHILE</a>
                <a href="comparacion.html" class="nav-tab">‚öñÔ∏è Comparaci√≥n</a>
                <a href="desafios.html" class="nav-tab">üèÜ Desaf√≠os</a>
            </div>

            <!-- Contenido FOR -->
            <div class="for-content">
                <h2 class="lesson-title">
                    üó∫Ô∏è Bucle FOR: Siguiendo el Mapa del Tesoro
                </h2>

                <div class="story-box">
                    <p>
                        <strong>Historia:</strong> El Capit√°n CodeBeard tiene un mapa con
                        5 islas marcadas. Cada isla contiene un tesoro, pero para
                        encontrarlos todos, necesitamos visitar cada una de ellas de
                        manera sistem√°tica. ¬°Los bucles FOR son perfectos para esta tarea!
                    </p>
                    <p>
                        Un bucle FOR se usa cuando
                        <strong>sabemos exactamente cu√°ntas veces</strong> queremos
                        repetir una acci√≥n.
                    </p>
                    
                    </div>
                    <p>
                        Antes de ejecutar los c√≥digos y contestar los cuestionarios, atiende el siguiente video: 
                    
                     <a
                href="https://www.youtube.com/embed/dsbhpCzQeTc?si=_2Ku-KRx7rCwKKbs"
                target="_blank"
            ><b>AQU√ç</b></a></p>

                <!-- Primer Ejercicio: Islas -->
                <div class="interactive-section">
                    <h3>üéÆ ¬°Prueba el c√≥digo!</h3>
                    
                    <!-- Estado de ejecuci√≥n -->
                    <div class="execution-status waiting" id="execution-status-1">
                        <span class="status-icon">‚è≥</span>
                        <strong>Estado:</strong> <span id="status-text-1">Presiona ‚ñ∂Ô∏è Ejecutar en el IDE para comenzar</span>
                    </div>

                    <div class="output" id="for-output">
                        <p>Presiona el bot√≥n Run para comenzar la aventura...</p>
                    </div>
                    <div class="code-container">
                        <div class="code-title">üèùÔ∏è Visitando las 5 Islas del Tesoro</div>
                        <iframe
                            src="https://disenioweb2025.github.io/ide_basico_python/?codigo=JTIzTGlzdGElMjBkZSUyMGlzbGFzJTIwZW4lMjBudWVzdHJvJTIwbWFwYSUwQWlzbGFzJTIwJTNEJTIwJTVCJTIySXNsYSUyMENhbGF2ZXJhJTIyJTJDJTIySXNsYSUyMExvcm8lMjIlMkMlMjJJc2xhJTIwQ2ElQzMlQjElQzMlQjNuJTIyJTJDJTIySXNsYSUyMFNpcmVuYSUyMiUyQyUyMklzbGElMjBEb3JhZGElMjIlNUQlMEElMEElMjMlMjBFbCUyMGJ1Y2xlJTIwRk9SJTIwdmlzaXRhJTIwY2FkYSUyMGlzbGElMjBhdXRvbSVDMyVBMXRpY2FtZW50ZSUwQWZvciUyMGlzbGElMjBpbiUyMGlzbGFzJTNBJTBBJTIwJTIwcHJpbnQoZiUyMiVGMCU5RiU4RiVCNCVFMiU4MCU4RCVFMiU5OCVBMCVFRiVCOCU4RiUyMExsZWdhbW9zJTIwYSUyMCU3QmlzbGElN0QhJTIyKSUyMCUwQSUyMCUyMHByaW50KCUyMiVGMCU5RiU5NCU4RCUyMEJ1c2NhbmRvJTIwdGVzb3Jvcy4uLiUyMCElMjIpJTBBJTIwJTIwcHJpbnQoJTIyJUYwJTlGJTkyJUIwJTIwJUMyJUExVGVzb3JvJTIwZW5jb250cmFkbyElMjIpJTBBJTIwJTIwcHJpbnQoJTIyLS0tJTIyKSUwQSUwQSUyMyUyMCVGMCU5RiU4RiVCNCVFMiU4MCU4RCVFMiU5OCVBMCVFRiVCOCU4RiUyMCVDMiVBMUVzY3JpYmUlMjB0dSUyMGMlQzMlQjNkaWdvJTIwYXF1JUMzJUFEISUwQSUyMyUyMEVqZW1wbG8lM0ElMjBjcmVhciUyMHVuYSUyMGxpc3RhJTIwZGUlMjB0ZXNvcm9z"
                            width="100%"
                            height="650"
                            frameborder="0"
                            data-exercise="for-islas"
                            id="iframe-1"
                        ></iframe>

                        <!-- Controles de verificaci√≥n -->
                        <div class="verify-controls">
                            <button class="verify-button" onclick="verificarEjecucion(1)" id="verify-btn-1">
                                üîç Verificar Ejecuci√≥n
                            </button>
                            <div class="mini-log" id="log-1" style="display: none;">
                                [Sistema] Listo para verificar...
                            </div>
                        </div>
                        
                        <div class="quiz">
                            <p>
                                <strong>
                                    ¬øCu√°ntas veces se imprime la l√≠nea "üí∞ ¬°Tesoro
                                    encontrado!"?
                                </strong><br>
                            </p>
                            <form>
                                <label>
                                    <input type="radio" name="quiz-for-islas" value="a"> 
                                    a) 1 vez
                                </label>
                                <label>
                                    <input type="radio" name="quiz-for-islas" value="b"> 
                                    b) 3 veces
                                </label>
                                <label>
                                    <input type="radio" name="quiz-for-islas" value="c"> 
                                    c) 5 veces
                                </label>
                                <label>
                                    <input type="radio" name="quiz-for-islas" value="d"> 
                                    d) Depende del usuario
                                </label><br>
                                <button
                                    type="button"
                                    onclick="verificarRespuesta('for-islas', 'c')"
                                >
                                    Responder
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Resto del contenido igual... -->
                <div class="interactive-section">
                    <h3>üéÆ ¬°Continua probando c√≥digo!</h3>
                    <div class="output" id="for-output2">
                        <p>Luego de ejecutar, haz cambios...</p>
                    </div>
                    <div class="code-container">
                        <div class="code-title">
                            üî¢ Contando Monedas de Oro (FOR con n√∫meros)
                        </div>
                        <iframe
                            src="https://trinket.io/embed/python3/7b273451c092"
                            width="100%"
                            height="350"
                            frameborder="0"
                            data-exercise="for-monedas"
                        ></iframe>
                        
                             <script src="//onlinegdb.com/embed/js/zibMvrm3e?theme=dark"></script>
                           

                       
                        <!-- Quiz igual... -->
                    </div>
                </div>

                <!-- Explicaci√≥n t√©cnica igual... -->
                <div class="treasure-box">
                    <h3>üß≠ Resumen del Bucle FOR</h3>
                    <p><strong>¬øCu√°ndo usar FOR?</strong> Cuando sabes exactamente cu√°ntas veces quieres repetir algo.</p>
                    <!-- Resto del contenido igual -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="script.js"></script>
    
    <script>
        // Variables globales para manejar estado
        let esperandoRespuesta = {};
        let timeouts = {};

        // Escuchar mensajes del iframe (PostMessage API)
        window.addEventListener('message', function(event) {
            // Verificar origen por seguridad (ajusta seg√∫n tu dominio del IDE)
            if (event.origin !== 'https://disenioweb2025.github.io') {
                return;
            }

            log(1, `üì® Mensaje recibido: ${JSON.stringify(event.data)}`);

            // Procesar diferentes tipos de mensajes
            if (event.data.type === 'pythonExecutionComplete') {
                manejarEjecucionCompleta(event.data);
            } else if (event.data.type === 'pythonStatus') {
                manejarEstadoPython(event.data);
            }
        });

        // Funci√≥n para verificar ejecuci√≥n usando PostMessage
        async function verificarEjecucion(ejercicioNum) {
            const iframe = document.getElementById(`iframe-${ejercicioNum}`);
            const statusElement = document.getElementById(`execution-status-${ejercicioNum}`);
            const statusText = document.getElementById(`status-text-${ejercicioNum}`);
            const verifyBtn = document.getElementById(`verify-btn-${ejercicioNum}`);
            const logElement = document.getElementById(`log-${ejercicioNum}`);

            // Mostrar estado de verificaci√≥n
            verifyBtn.disabled = true;
            verifyBtn.textContent = "üîç Verificando...";
            logElement.style.display = "block";
            
            log(ejercicioNum, "üîÑ Solicitando estado del IDE...");

            try {
                // Marcar que estamos esperando respuesta
                esperandoRespuesta[ejercicioNum] = true;

                // Enviar mensaje al iframe pidiendo el estado
                iframe.contentWindow.postMessage({
                    type: 'requestPythonStatus',
                    exerciseId: ejercicioNum
                }, 'https://disenioweb2025.github.io');

                log(ejercicioNum, "üì§ Mensaje enviado al IDE");

                // Timeout de 10 segundos
                timeouts[ejercicioNum] = setTimeout(() => {
                    if (esperandoRespuesta[ejercicioNum]) {
                        esperandoRespuesta[ejercicioNum] = false;
                        
                        statusElement.className = "execution-status error";
                        statusText.textContent = "‚è∞ Tiempo de espera agotado. Intenta nuevamente.";
                        
                        log(ejercicioNum, "‚è∞ Timeout - No se recibi√≥ respuesta del IDE");
                        
                        verifyBtn.disabled = false;
                        verifyBtn.textContent = "üîç Verificar Ejecuci√≥n";
                    }
                }, 10000);

            } catch (error) {
                console.error("Error al verificar:", error);
                
                statusElement.className = "execution-status error";
                statusText.textContent = "‚ùå Error al comunicarse con el IDE";
                
                log(ejercicioNum, `‚ùå Error: ${error.message}`);
                
                verifyBtn.disabled = false;
                verifyBtn.textContent = "üîç Verificar Ejecuci√≥n";
                
                esperandoRespuesta[ejercicioNum] = false;
            }
        }

        // Manejar respuesta de estado del Python
        function manejarEstadoPython(data) {
            const ejercicioNum = data.exerciseId || 1;
            
            // Limpiar timeout
            if (timeouts[ejercicioNum]) {
                clearTimeout(timeouts[ejercicioNum]);
            }
            
            // Verificar si est√°bamos esperando esta respuesta
            if (!esperandoRespuesta[ejercicioNum]) {
                return;
            }
            
            esperandoRespuesta[ejercicioNum] = false;

            const statusElement = document.getElementById(`execution-status-${ejercicioNum}`);
            const statusText = document.getElementById(`status-text-${ejercicioNum}`);
            const verifyBtn = document.getElementById(`verify-btn-${ejercicioNum}`);

            log(ejercicioNum, `üìä Estado recibido: ${JSON.stringify(data.status)}`);

            if (data.status.isLoading) {
                log(ejercicioNum, "‚è≥ Python a√∫n se est√° cargando");
                
                statusElement.className = "execution-status waiting";
                statusText.textContent = "‚è≥ Python se est√° cargando, intenta en unos momentos";
                
            } else if (data.status.success || data.status.error) {
                // El c√≥digo fue ejecutado (con √©xito o error)
                statusElement.className = "execution-status executed";
                statusText.textContent = "‚úÖ ¬°C√≥digo ejecutado! üéâ";
                
                log(ejercicioNum, "üéâ ¬°C√≥digo ejecutado correctamente!");
                
                // Agregar moneda
                agregarMoneda();
                
            } else {
                // El c√≥digo no ha sido ejecutado
                statusElement.className = "execution-status waiting";
                statusText.textContent = "‚ö†Ô∏è Ejecuta el c√≥digo primero presionando ‚ñ∂Ô∏è";
                
                log(ejercicioNum, "‚ö†Ô∏è C√≥digo no ejecutado a√∫n");
            }

            // Rehabilitar bot√≥n
            verifyBtn.disabled = false;
            verifyBtn.textContent = "üîç Verificar Ejecuci√≥n";
        }

        // Manejar ejecuci√≥n completa (autom√°tica cuando se ejecuta c√≥digo)
        function manejarEjecucionCompleta(data) {
            log(1, `üéØ Ejecuci√≥n autom√°tica detectada: √©xito=${data.success}`);
            
            // Opcional: actualizar autom√°ticamente el estado cuando se ejecuta c√≥digo
            // (sin necesidad de presionar el bot√≥n de verificar)
            /*
            const statusElement = document.getElementById('execution-status-1');
            const statusText = document.getElementById('status-text-1');
            
            if (data.success || data.error) {
                statusElement.className = "execution-status executed";
                statusText.textContent = "‚úÖ ¬°C√≥digo ejecutado autom√°ticamente! üéâ";
            }
            */
        }

        // Funci√≥n para agregar monedas
        function agregarMoneda() {
            const contador = document.getElementById('contador-monedas');
            let monedas = parseInt(contador.textContent) || 0;
            monedas++;
            contador.textContent = monedas;
            
            // Guardar en localStorage
            if (typeof localStorage !== 'undefined') {
                localStorage.setItem('monedas-piratas', monedas.toString());
            }
            
            log(1, `ü™ô ¬°Moneda a√±adida! Total: ${monedas}`);
        }

        // Funci√≥n de logging
        function log(ejercicioNum, mensaje) {
            const logElement = document.getElementById(`log-${ejercicioNum}`);
            if (logElement) {
                const timestamp = new Date().toLocaleTimeString();
                logElement.innerHTML += `<br>[${timestamp}] ${mensaje}`;
                logElement.scrollTop = logElement.scrollHeight;
            }
            console.log(`[Ejercicio ${ejercicioNum}] ${mensaje}`);
        }

        // Cargar monedas guardadas
        window.addEventListener('load', () => {
            if (typeof localStorage !== 'undefined') {
                const monedasGuardadas = localStorage.getItem('monedas-piratas');
                if (monedasGuardadas) {
                    document.getElementById('contador-monedas').textContent = monedasGuardadas;
                }
            }
        });

        // Funci√≥n del quiz (mantener tu funci√≥n original)
        function verificarRespuesta(quizName, correctAnswer) {
            // Tu l√≥gica original del quiz aqu√≠
            console.log(`Quiz ${quizName}: respuesta correcta es ${correctAnswer}`);
        }
    </script>
</body>
</html>    
